import{a as v}from"./axios-upsvKRUO.js";import{e as $,f as w,i as f,o as x,c as _,w as s,a as l,d as b,b as m,j as k,r as d,_ as j}from"./index-0a0EsJOX.js";import{a as D}from"./Axios-DLQG3O6d.js";const S=$({__name:"Experience",setup(z){const p=w(),g=w(!0),y=()=>{g.value=!g.value},F=(n,e,a)=>{if(e==="")a(new Error("请输入密码"));else{if(t.checkPass!==""){if(!p.value)return;p.value.validateField("checkPass")}a()}},C=(n,e,a)=>{e===""?a(new Error("请再次输入密码")):e!==t.pass?a(new Error("两次输入密码不一致!")):a()},i=f({email:"",password:""}),t=f({name:"",email:"",pass:"",checkPass:"",realName:"",sex:"",fileList:[]}),N=f({pass:[{validator:F,trigger:"blur"}],checkPass:[{validator:C,trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}]}),P=f({email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:15,message:"长度在 6到 15 个字符",trigger:"blur"}]}),U=async()=>{let n=JSON.stringify(i),e="/api/login";try{const o=(await v.post(e,n,{headers:{"Content-Type":"application/json"}})).data.data;localStorage.setItem("token",o);const u=await D.get("/api/users",{params:{email:i.email}});console.log(u.data),k.push({path:"/assignments/info",state:{data:u.data.data}})}catch(a){console.error("登陆失败",a),alert("登陆失败")}},L=async n=>{n&&n.validate(async e=>{if(e){console.log("Valid form data:",t);const a=new FormData;a.append("name",t.name),a.append("email",t.email),a.append("pass",t.pass),a.append("realName",t.realName),a.append("sex",t.sex),t.fileList.forEach(o=>{a.append("img",o)}),console.log("提交",a);try{const o=await v.post("/api/login/register",a,{headers:{"Content-Type":"multipart/form-data"}});console.log("Form submitted successfully:",o.data),o.data.code===1?k.push({path:"/assignments/submit",state:{data:o.data.data}}):console.error("后端返回错误:",o.data.msg)}catch(o){console.error("Error submitting form:",o)}}else console.log("error submit!")})},q=n=>{n&&n.resetFields()},E=n=>(console.log("文件准备上传：",n.name),!0),R=(n,e)=>ElMessageBox.confirm(`Cancel the transfer of ${n.name} ?`).then(()=>!0,()=>!1),B=async n=>{t.fileList.push(n.file),console.log(t.fileList[0])};return(n,e)=>{const a=d("el-input"),o=d("el-form-item"),u=d("el-button"),V=d("el-form"),c=d("el-option"),I=d("el-select"),T=d("el-upload");return g.value?(x(),_(V,{key:0,ref:"LoginForm",style:{"max-width":"600px"},model:i,"status-icon":"",rules:P,"label-width":"auto",class:"Form"},{default:s(()=>[l(o,{label:"邮箱"},{default:s(()=>[l(a,{modelValue:i.email,"onUpdate:modelValue":e[0]||(e[0]=r=>i.email=r),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),l(o,{label:"密码"},{default:s(()=>[l(a,{modelValue:i.password,"onUpdate:modelValue":e[1]||(e[1]=r=>i.password=r),type:"password",autocomplete:"off",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),l(o,null,{default:s(()=>[e[11]||(e[11]=b("br",null,null,-1)),l(u,{type:"primary",onClick:U},{default:s(()=>e[10]||(e[10]=[m("登录")])),_:1})]),_:1}),l(o,null,{default:s(()=>[l(u,{onClick:y},{default:s(()=>e[12]||(e[12]=[m("注册")])),_:1})]),_:1})]),_:1},8,["model","rules"])):(x(),_(V,{key:1,ref_key:"FormRef",ref:p,style:{"max-width":"600px"},model:t,"status-icon":"",rules:N,"label-width":"auto",class:"Form"},{default:s(()=>[l(o,{label:"用户名"},{default:s(()=>[l(a,{modelValue:t.name,"onUpdate:modelValue":e[2]||(e[2]=r=>t.name=r)},null,8,["modelValue"])]),_:1}),l(o,{prop:"email",label:"邮箱地址",rules:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}]},{default:s(()=>[l(a,{modelValue:t.email,"onUpdate:modelValue":e[3]||(e[3]=r=>t.email=r)},null,8,["modelValue"])]),_:1}),l(o,{label:"设置密码",prop:"pass"},{default:s(()=>[l(a,{modelValue:t.pass,"onUpdate:modelValue":e[4]||(e[4]=r=>t.pass=r),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),l(o,{label:"确认密码",prop:"checkPass"},{default:s(()=>[l(a,{modelValue:t.checkPass,"onUpdate:modelValue":e[5]||(e[5]=r=>t.checkPass=r),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),l(o,{label:"真实姓名"},{default:s(()=>[l(a,{modelValue:t.realName,"onUpdate:modelValue":e[6]||(e[6]=r=>t.realName=r)},null,8,["modelValue"])]),_:1}),l(o,{label:"性别"},{default:s(()=>[l(I,{modelValue:t.sex,"onUpdate:modelValue":e[7]||(e[7]=r=>t.sex=r),placeholder:"请选择",size:"large",style:{width:"150px"}},{default:s(()=>[l(c,{label:"男",value:"male"}),l(c,{label:"女",value:"female"})]),_:1},8,["modelValue"])]),_:1}),l(o,null,{default:s(()=>[e[15]||(e[15]=m("        ")),l(T,{class:"upload-demo","http-request":B,"before-upload":E,"before-remove":R,limit:1},{tip:s(()=>e[14]||(e[14]=[b("div",{class:"el-upload__tip"},null,-1)])),default:s(()=>[l(u,{type:"primary"},{default:s(()=>e[13]||(e[13]=[m("上传头像")])),_:1})]),_:1})]),_:1}),l(o,null,{default:s(()=>[e[18]||(e[18]=b("br",null,null,-1)),e[19]||(e[19]=m("    ")),l(u,{type:"primary",onClick:e[8]||(e[8]=r=>L(p.value))},{default:s(()=>e[16]||(e[16]=[m(" 提交 ")])),_:1}),l(u,{onClick:e[9]||(e[9]=r=>q(p.value))},{default:s(()=>e[17]||(e[17]=[m("重置")])),_:1})]),_:1}),l(o,null,{default:s(()=>[l(u,{type:"text",onClick:y,style:{"margin-left":"15em"}},{default:s(()=>e[20]||(e[20]=[m("返回登录")])),_:1})]),_:1})]),_:1},8,["model","rules"]))}}}),A=j(S,[["__scopeId","data-v-351d332c"]]);export{A as default};
